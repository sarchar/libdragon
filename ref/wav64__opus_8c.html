<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libdragon: wav64_opus.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libdragon
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_a63dedf81f1e5ea1d42bb45ef831eb8c.html">audio</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">wav64_opus.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Support for opus-compressed WAV64 files.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structwav64__opus__header__ext"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wav64__opus_8c.html#structwav64__opus__header__ext">wav64_opus_header_ext</a></td></tr>
<tr class="memdesc:structwav64__opus__header__ext"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wav64 Opus header extension.  <a href="wav64__opus_8c.html#structwav64__opus__header__ext">More...</a><br /></td></tr>
<tr class="separator:structwav64__opus__header__ext"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structwav64__opus__state"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wav64__opus_8c.html#structwav64__opus__state">wav64_opus_state</a></td></tr>
<tr class="memdesc:structwav64__opus__state"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wav64 Opus state.  <a href="wav64__opus_8c.html#structwav64__opus__state">More...</a><br /></td></tr>
<tr class="separator:structwav64__opus__state"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a48b2ffe9d75adff3bd4ce80d07cb46d1"><td class="memItemLeft" align="right" valign="top"><a id="a48b2ffe9d75adff3bd4ce80d07cb46d1" name="a48b2ffe9d75adff3bd4ce80d07cb46d1"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>wav64_opus_init</b> (<a class="el" href="wav64_8h.html#structwav64__t">wav64_t</a> *wav, int fh)</td></tr>
<tr class="memdesc:a48b2ffe9d75adff3bd4ce80d07cb46d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize opus decompression on a wav64 file. <br /></td></tr>
<tr class="separator:a48b2ffe9d75adff3bd4ce80d07cb46d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27c860b6445e13ba1acfc2c2da3eda0b"><td class="memItemLeft" align="right" valign="top"><a id="a27c860b6445e13ba1acfc2c2da3eda0b" name="a27c860b6445e13ba1acfc2c2da3eda0b"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>wav64_opus_close</b> (<a class="el" href="wav64_8h.html#structwav64__t">wav64_t</a> *wav)</td></tr>
<tr class="memdesc:a27c860b6445e13ba1acfc2c2da3eda0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shut down opus decompression on a wav64 file. <br /></td></tr>
<tr class="separator:a27c860b6445e13ba1acfc2c2da3eda0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ee980d59d42416d36918f2374a0a2ef"><td class="memItemLeft" align="right" valign="top"><a id="a2ee980d59d42416d36918f2374a0a2ef" name="a2ee980d59d42416d36918f2374a0a2ef"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>wav64_opus_get_bitrate</b> (<a class="el" href="wav64_8h.html#structwav64__t">wav64_t</a> *wav)</td></tr>
<tr class="memdesc:a2ee980d59d42416d36918f2374a0a2ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the bitrate for a wav64 file. <br /></td></tr>
<tr class="separator:a2ee980d59d42416d36918f2374a0a2ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Support for opus-compressed WAV64 files. </p>
<dl class="section author"><dt>Author</dt><dd>Giovanni Bajo (<a href="#" onclick="location.href='mai'+'lto:'+'gio'+'va'+'nni'+'ba'+'jo@'+'gm'+'ail'+'.c'+'om'; return false;">giova<span class="obfuscator">.nosp@m.</span>nnib<span class="obfuscator">.nosp@m.</span>ajo@g<span class="obfuscator">.nosp@m.</span>mail<span class="obfuscator">.nosp@m.</span>.com</a>)</dd></dl>
<h2><a class="anchor" id="autotoc_md9"></a>
Opus notes</h2>
<p >This section details how the Opus format is used in wav64. Opus is made by a mix of two different coders: CELT and SILK. CELT is used for larger frames and is more apt for music, while SILK is used for smaller frames and is more apt for speech. Our N64 implementation only uses CELT. In fact, the whole Opus layer (which is a framing layer) is not used at all.</p>
<p >A WAV64 file compressed with Opus contains a sequence of raw CELT frames. Since CELT requires framing (that is, the length of the compressed frame must be known in advance), a very simple framing is used: each frame is preceded by a 16-bit integer that contains the compressed length of the frame itself. Moreover, frames are forced to be 2-byte aligned, so that they're easier to read them via DMA.</p>
<p >At the API level, we use the opus_custom API which is a CELT-only API that allows to implement custom "modes". A "mode" is the configuration of the codec, in terms of sample rate and frame size. Standard CELT only supports 48kHz with frames of some specific length (from 2.5ms to 60ms in various steps). For N64, we want to flexibility of experimenting with different sample rates and frame sizes. For instance, currently the implementation defaults to 32 Khz and 20ms frames (640 samples per frame), which seems a good compromise between quality and performance. </p>
</div><hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structwav64__opus__header__ext" id="structwav64__opus__header__ext"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structwav64__opus__header__ext">&#9670;&nbsp;</a></span>wav64_opus_header_ext</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct wav64_opus_header_ext</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p >Wav64 Opus header extension. </p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a273928da878d8bb39f9819f564b5bc07" name="a273928da878d8bb39f9819f564b5bc07"></a>uint32_t</td>
<td class="fieldname">
frame_size</td>
<td class="fielddoc">
Size of an audioframe in samples. </td></tr>
<tr><td class="fieldtype">
<a id="a989bc22dca04cdb07220df8e9619b4ba" name="a989bc22dca04cdb07220df8e9619b4ba"></a>uint32_t</td>
<td class="fieldname">
max_cmp_frame_size</td>
<td class="fielddoc">
Maximum compressed frame size in bytes. </td></tr>
<tr><td class="fieldtype">
<a id="a03c77d0250030a011c6409b50b53cefe" name="a03c77d0250030a011c6409b50b53cefe"></a>uint32_t</td>
<td class="fieldname">
bitrate_bps</td>
<td class="fielddoc">
Bitrate in bits per second. </td></tr>
</table>

</div>
</div>
<a name="structwav64__opus__state" id="structwav64__opus__state"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structwav64__opus__state">&#9670;&nbsp;</a></span>wav64_opus_state</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct wav64_opus_state</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p >Wav64 Opus state. </p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="af478873a4568a3e13ec6c119822d610c" name="af478873a4568a3e13ec6c119822d610c"></a><a class="el" href="wav64__opus_8c.html#structwav64__opus__header__ext">wav64_opus_header_ext</a></td>
<td class="fieldname">
xhead</td>
<td class="fielddoc">
Opus header extension. </td></tr>
<tr><td class="fieldtype">
<a id="aeb35fff8da4a8a5111307f30be30707e" name="aeb35fff8da4a8a5111307f30be30707e"></a>uint32_t</td>
<td class="fieldname">
current_rom_addr</td>
<td class="fielddoc">
Current ROM reading address. </td></tr>
<tr><td class="fieldtype">
<a id="a9d37cc5d5d22399087ddcb72aece3a5d" name="a9d37cc5d5d22399087ddcb72aece3a5d"></a>OpusCustomMode *</td>
<td class="fieldname">
mode</td>
<td class="fielddoc">
Opus custom mode for this file. </td></tr>
<tr><td class="fieldtype">
<a id="a9da7ba3af81696a0d6fd00074e07b00b" name="a9da7ba3af81696a0d6fd00074e07b00b"></a>OpusCustomDecoder *</td>
<td class="fieldname">
dec</td>
<td class="fielddoc">
Opus decoder for this file. </td></tr>
</table>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 8 2024 04:25:39 for libdragon by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
